# 扩展故障注入系统计划

## 🎯 目标
将当前的3种系统级故障扩展为完整的6种故障类型，包括训练级动态故障注入。

## 📋 实施步骤

### 1. 扩展FaultInjector类
- 添加 `inject_nan_loss()` 方法：通过修改梯度或损失函数注入NaN
- 添加 `inject_oom()` 方法：动态分配大量内存触发OOM
- 添加 `inject_non_convergence()` 方法：运行时调整学习率

### 2. 实现训练过程钩子机制
- 创建 `TrainingHook` 类，集成到BERT训练流程
- 支持运行时参数修改（学习率、批次大小等）
- 实现梯度拦截和损失函数修改

### 3. 增强故障调度器
- 支持基于训练步数的精确注入时机
- 添加故障强度控制（轻微/中等/严重）
- 实现故障恢复机制

### 4. 完善配置系统
- 统一配置文件与实现代码
- 添加故障参数验证
- 支持故障组合和序列化注入

### 5. 扩展监控能力
- 增强异常检测精度
- 添加故障注入状态跟踪
- 完善Ground Truth标注

## 🔧 技术实现要点

### NaN Loss注入
```python
def inject_nan_loss(self, target_step: int):
    # 在指定训练步骤注入NaN到梯度或损失
    # 通过PyTorch钩子机制实现
```

### OOM注入
```python
def inject_oom(self, memory_size_gb: float):
    # 动态分配大量GPU/CPU内存
    # 触发真实的内存溢出异常
```

### 不收敛注入
```python
def inject_non_convergence(self, lr_multiplier: float):
    # 运行时修改优化器学习率
    # 导致训练发散或停滞
```

## 📊 预期成果
- 支持完整的6种故障类型
- 实现训练级和系统级故障的统一管理
- 提供更精确的异常数据标注
- 增强TSE-Matrix数据集的多样性和质量

## ⏱️ 实施优先级
1. **高优先级**：NaN Loss注入（最常见的训练异常）
2. **中优先级**：OOM注入（GPU环境常见问题）
3. **低优先级**：不收敛注入（可通过配置实现）